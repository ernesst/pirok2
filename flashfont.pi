#!/usr/bin/python

import spidev #bibliotheque SPI
import time # pour tempo 1s
import numpy as np #bit and hex management
import random

# Parametres font / couleur
cBlanc = 254
cBleu = 0x32 #2
cRouge = 0xC4 #224
cVert = 28
fBig=200
fSmall=201


# Image Perroquet full color
fp = open('pirok6.digole')

bigfont = [
0x00,0x1b,0x2c,0x00,0x00,0x2c,0x04,0xbc,0x00,0x00,0x00,0x46,0x00,0x00,0x00,0x2c
,0x00,0x00,0x00,0x00,0x03,0x00,0x2c,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x1b,0x00,0x2c,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0x0d,0x0d,0x1a,0x0f,0x00,0x1a,0x0f,0x80,0x1f,0xc0
,0x30,0x60,0x60,0x30,0xc0,0x18,0xc0,0x18,0xc0,0x18,0xc0,0x18,0xc0,0x18,0x60,0x30
,0x30,0x60,0x1f,0xc0,0x0f,0x80,0x04,0x06,0x06,0x06,0x00,0x01,0x30,0x70,0x60,0xe0
,0xc0,0xc0,0xff,0x04,0x03,0x03,0x05,0x00,0x05,0x60,0xf0,0x60,0xff,0x19,0x22,0x88
,0x1a,0x00,0x05,0x00,0xff,0x80,0x00,0x03,0xff,0xe0,0x00,0x07,0x00,0x78,0x00,0x0e
,0x00,0x38,0x00,0x1c,0x00,0x1c,0x00,0x18,0x00,0x0e,0x00,0x30,0x00,0x06,0x00,0x30
,0x00,0x03,0x00,0x60,0x00,0x03,0x00,0x60,0x00,0x03,0x00,0x60,0x00,0x03,0x00,0xc0
,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0
,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0
,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xc0,0x00,0x01,0x80,0xe0,0x00,0x03,0x80,0x60
,0x00,0x03,0x00,0x60,0x00,0x03,0x00,0x70,0x00,0x03,0x00,0x30,0x00,0x07,0x00,0x38
,0x00,0x06,0x00,0x18,0x00,0x0e,0x00,0x1c,0x00,0x1c,0x00,0x0e,0x00,0x38,0x00,0x07
,0x00,0x70,0x00,0x03,0xff,0xe0,0x00,0x00,0xff,0x80,0x00,0x0a,0x22,0x44,0x0c,0x00
,0x05,0x00,0xc0,0x01,0xc0,0x03,0xc0,0x03,0xc0,0x07,0xc0,0x0e,0xc0,0x0c,0xc0,0x1c
,0xc0,0x38,0xc0,0x70,0xc0,0xe0,0xc0,0xc0,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00
,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00
,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00,0xc0,0x00
,0xc0,0x00,0xc0,0x00,0xc0,0x17,0x22,0x66,0x19,0x00,0x05,0x01,0xff,0x80,0x07,0xff
,0xe0,0x0e,0x00,0x78,0x1c,0x00,0x38,0x38,0x00,0x1c,0x70,0x00,0x0e,0x60,0x00,0x06
,0x60,0x00,0x06,0xc0,0x00,0x06,0xc0,0x00,0x06,0xc0,0x00,0x06,0x00,0x00,0x06,0x00
,0x00,0x06,0x00,0x00,0x06,0x00,0x00,0x0e,0x00,0x00,0x1c,0x00,0x00,0x38,0x00,0x00
,0x78,0x00,0x00,0xf0,0x00,0x01,0xc0,0x00,0x03,0x80,0x00,0x07,0x00,0x00,0x0e,0x00
,0x00,0x3c,0x00,0x00,0x78,0x00,0x00,0xe0,0x00,0x01,0xc0,0x00,0x03,0x80,0x00,0x07
,0x00,0x00,0x1e,0x00,0x00,0x38,0x00,0x00,0x70,0x00,0x00,0xff,0xff,0xfe,0xff,0xff
,0xfe,0x17,0x22,0x66,0x18,0x00,0x05,0x01,0xff,0x00,0x07,0xff,0xc0,0x1e,0x00,0xe0
,0x38,0x00,0x70,0x30,0x00,0x38,0x70,0x00,0x18,0x60,0x00,0x1c,0x00,0x00,0x0c,0x00
,0x00,0x0c,0x00,0x00,0x0c,0x00,0x00,0x1c,0x00,0x00,0x18,0x00,0x00,0x38,0x00,0x00
,0x70,0x00,0x00,0xe0,0x00,0xff,0xc0,0x00,0xff,0xc0,0x00,0x01,0xf0,0x00,0x00,0x38
,0x00,0x00,0x1c,0x00,0x00,0x0c,0x00,0x00,0x06,0x00,0x00,0x06,0x00,0x00,0x06,0x00
,0x00,0x06,0x00,0x00,0x06,0xc0,0x00,0x06,0xc0,0x00,0x06,0x60,0x00,0x0e,0x70,0x00
,0x0c,0x38,0x00,0x3c,0x1c,0x00,0x70,0x0f,0xff,0xe0,0x03,0xff,0x80,0x18,0x22,0x66
,0x19,0x00,0x05,0x00,0x00,0x18,0x00,0x00,0x38,0x00,0x00,0x78,0x00,0x00,0xf8,0x00
,0x00,0xf8,0x00,0x01,0xd8,0x00,0x03,0x98,0x00,0x07,0x18,0x00,0x0e,0x18,0x00,0x0c
,0x18,0x00,0x1c,0x18,0x00,0x38,0x18,0x00,0x70,0x18,0x00,0xe0,0x18,0x00,0xc0,0x18
,0x01,0xc0,0x18,0x03,0x80,0x18,0x07,0x00,0x18,0x0e,0x00,0x18,0x0c,0x00,0x18,0x1c
,0x00,0x18,0x38,0x00,0x18,0x70,0x00,0x18,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00
,0x18,0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,0x18
,0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,0x18,0x18,0x22,0x66,0x19,0x00,0x05,0x7f
,0xff,0xf8,0x7f,0xff,0xf8,0x60,0x00,0x00,0x60,0x00,0x00,0x60,0x00,0x00,0x60,0x00
,0x00,0x60,0x00,0x00,0x60,0x00,0x00,0x60,0x00,0x00,0x60,0x00,0x00,0x60,0x00,0x00
,0x60,0x00,0x00,0x67,0xff,0x80,0x7f,0x03,0xe0,0x78,0x00,0x70,0x00,0x00,0x38,0x00
,0x00,0x1c,0x00,0x00,0x0c,0x00,0x00,0x06,0x00,0x00,0x06,0x00,0x00,0x06,0x00,0x00
,0x03,0x00,0x00,0x03,0x00,0x00,0x03,0x00,0x00,0x03,0x00,0x00,0x06,0xc0,0x00,0x06
,0xc0,0x00,0x0e,0x60,0x00,0x0c,0x70,0x00,0x1c,0x38,0x00,0x38,0x1e,0x00,0xf0,0x07
,0xff,0xc0,0x01,0xff,0x00,0x18,0x22,0x66,0x19,0x00,0x05,0x00,0x06,0x00,0x00,0x0e
,0x00,0x00,0x1c,0x00,0x00,0x18,0x00,0x00,0x38,0x00,0x00,0x70,0x00,0x00,0x60,0x00
,0x00,0xc0,0x00,0x01,0xc0,0x00,0x03,0x80,0x00,0x03,0x00,0x00,0x07,0x3c,0x00,0x0f
,0xff,0x80,0x0f,0xc3,0xe0,0x1e,0x00,0x70,0x38,0x00,0x38,0x30,0x00,0x1c,0x70,0x00
,0x0e,0x60,0x00,0x06,0x60,0x00,0x06,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03
,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x06,0x60,0x00,0x06,0x60
,0x00,0x0e,0x30,0x00,0x1c,0x38,0x00,0x38,0x1e,0x00,0x70,0x07,0xff,0xe0,0x01,0xff
,0x80,0x17,0x22,0x66,0x18,0x00,0x05,0xff,0xff,0xfe,0xff,0xff,0xfe,0x00,0x00,0x0c
,0x00,0x00,0x1c,0x00,0x00,0x18,0x00,0x00,0x38,0x00,0x00,0x30,0x00,0x00,0x70,0x00
,0x00,0x60,0x00,0x00,0xc0,0x00,0x01,0xc0,0x00,0x01,0x80,0x00,0x03,0x80,0x00,0x03
,0x00,0x00,0x07,0x00,0x00,0x06,0x00,0x00,0x0e,0x00,0x00,0x0c,0x00,0x00,0x1c,0x00
,0x00,0x18,0x00,0x00,0x30,0x00,0x00,0x70,0x00,0x00,0x60,0x00,0x00,0xe0,0x00,0x00
,0xc0,0x00,0x01,0xc0,0x00,0x01,0x80,0x00,0x03,0x80,0x00,0x03,0x00,0x00,0x06,0x00
,0x00,0x0e,0x00,0x00,0x0c,0x00,0x00,0x1c,0x00,0x00,0x18,0x00,0x00,0x18,0x22,0x66
,0x19,0x00,0x05,0x00,0x7e,0x00,0x03,0xff,0xc0,0x0f,0x00,0xf0,0x1c,0x00,0x38,0x18
,0x00,0x1c,0x30,0x00,0x0c,0x70,0x00,0x0e,0x60,0x00,0x06,0x60,0x00,0x06,0x60,0x00
,0x06,0x70,0x00,0x0c,0x38,0x00,0x0c,0x1c,0x00,0x18,0x0e,0x00,0x78,0x07,0x81,0xe0
,0x03,0xff,0xc0,0x07,0xff,0xe0,0x1e,0x00,0x78,0x38,0x00,0x1c,0x70,0x00,0x0e,0x60
,0x00,0x06,0xe0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00
,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03,0x60,0x00,0x07,0x70,0x00,0x06,0x38,0x00,0x0e
,0x1c,0x00,0x3c,0x0f,0xff,0xf0,0x01,0xff,0x80,0x18,0x22,0x66,0x1a,0x00,0x05,0x01
,0xff,0x80,0x07,0xff,0xe0,0x0e,0x00,0x78,0x1c,0x00,0x1c,0x38,0x00,0x0e,0x70,0x00
,0x06,0x60,0x00,0x06,0x60,0x00,0x06,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03
,0xc0,0x00,0x03,0xc0,0x00,0x03,0xc0,0x00,0x03,0x60,0x00,0x06,0x60,0x00,0x06,0x70
,0x00,0x06,0x38,0x00,0x0c,0x1c,0x00,0x1c,0x0f,0x00,0x78,0x07,0xff,0xf0,0x00,0xff
,0xf0,0x00,0x00,0xe0,0x00,0x00,0xc0,0x00,0x01,0xc0,0x00,0x03,0x80,0x00,0x03,0x00
,0x00,0x06,0x00,0x00,0x0e,0x00,0x00,0x1c,0x00,0x00,0x18,0x00,0x00,0x38,0x00,0x00
,0x70,0x00,0x00,0x60,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x0d,0x27,0x4e,0x10
,0x00,0x02,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0xff,0xf8,0x7f,0xf0,0x7f,0xf0,0x3f,0xe0,0x1f,0xc0,0x07,0x00
,0x0d,0x27,0x4e,0x10,0x00,0x02,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x78,0xc0,0xf8,0xe1,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0x7f,0xf0,0x7f,0xf0,0x3f,0xe0
,0x1f,0xc0,0x07,0x00,0x0d,0x27,0x4e,0x10,0x00,0x02,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x78
,0xc0,0xf8,0xe1,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0x7f,0xf0
,0x7f,0xf0,0x3f,0xe0,0x1f,0xc0,0x07,0x00,0x0d,0x27,0x4e,0x10,0x00,0x02,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08
,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x78,0xc0,0xf8,0xe1,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0x7f,0xf0,0x7f,0xf0,0x3f,0xe0,0x1f,0xc0,0x07,0x00,0x0d,0x27,0x4e,0x10
,0x00,0x02,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x08,0x80,0x78
,0xc0,0xf8,0xe1,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0x7f,0xf0,0x7f,0xf0,0x3f,0xe0,0x1f,0xc0,0x07,0x00
,0x0d,0x27,0x4e,0x0f,0x00,0x02,0x80,0x08,0x80,0x78,0xc0,0xf8,0xe1,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8
,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0xff,0xf8,0x7f,0xf0,0x7f,0xf0,0x3f,0xe0
,0x1f,0xc0,0x07,0x00]

smallfont = [
0x00,0x1a,0x11,0x00,0x00,0x11,0x00,0x00,0x01,0xee,0x00,0x64,0x00,0x00,0x00,0x11
,0x00,0x00,0x00,0x00,0x02,0x00,0x11,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x0b,0x00,0x11,0xff,0xff,0xff,0xff
,0xff,0xff,0x01,0x05,0x05,0x03,0x00,0x0b,0x80,0x80,0x80,0x80,0x80,0xff,0xff,0xff
,0x04,0x05,0x05,0x07,0x00,0x0b,0x60,0x90,0x90,0x90,0x60,0x02,0x03,0x03,0x05,0x00
,0x01,0x40,0x40,0x80,0xff,0x02,0x02,0x02,0x05,0x00,0x02,0xc0,0xc0,0x06,0x0e,0x0e
,0x08,0x00,0x02,0x04,0x08,0x08,0x08,0x10,0x10,0x30,0x20,0x20,0x60,0x40,0x40,0x80
,0x80,0x0a,0x0e,0x1c,0x0b,0x00,0x02,0x1e,0x00,0x21,0x00,0x40,0x80,0x80,0x40,0x80
,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x40,0x80,0x40,0x80,0x21
,0x00,0x1e,0x00,0x04,0x0e,0x0e,0x07,0x00,0x02,0x10,0x30,0x50,0x90,0x10,0x10,0x10
,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x09,0x0e,0x1c,0x0b,0x00,0x02,0x1e,0x00,0x21
,0x00,0x40,0x80,0x80,0x80,0x80,0x80,0x00,0x80,0x01,0x00,0x02,0x00,0x04,0x00,0x08
,0x00,0x10,0x00,0x20,0x00,0x40,0x00,0xff,0x80,0x09,0x0e,0x1c,0x0a,0x00,0x02,0x3e
,0x00,0x41,0x00,0x80,0x80,0x00,0x80,0x00,0x80,0x01,0x00,0x02,0x00,0x1e,0x00,0x01
,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x41,0x00,0x3e,0x00,0x09,0x0e,0x1c,0x0a,0x00
,0x02,0x01,0x00,0x03,0x00,0x05,0x00,0x09,0x00,0x11,0x00,0x21,0x00,0x41,0x00,0x81
,0x00,0xff,0x80,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x09,0x0e,0x1c
,0x0b,0x00,0x02,0xff,0x80,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0xfc,0x00,0x03
,0x00,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x81,0x00,0x42,0x00,0x3c,0x00,0x09
,0x0e,0x1c,0x0b,0x00,0x02,0x01,0x00,0x02,0x00,0x04,0x00,0x08,0x00,0x10,0x00,0x20
,0x00,0x7e,0x00,0x41,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x41,0x00,0x3e
,0x00,0x09,0x0e,0x1c,0x0a,0x00,0x02,0xff,0x80,0x01,0x00,0x01,0x00,0x02,0x00,0x02
,0x00,0x04,0x00,0x08,0x00,0x08,0x00,0x10,0x00,0x10,0x00,0x20,0x00,0x20,0x00,0x40
,0x00,0x40,0x00,0x0b,0x0e,0x1c,0x0c,0x00,0x02,0x1f,0x00,0x20,0x80,0x40,0x40,0x40
,0x40,0x40,0x40,0x20,0x80,0x3f,0x80,0x40,0x40,0x80,0x20,0x80,0x20,0x80,0x20,0x80
,0x20,0x40,0x40,0x3f,0x80,0x0a,0x0e,0x1c,0x0b,0x00,0x02,0x1e,0x00,0x21,0x00,0x40
,0x80,0x80,0x40,0x80,0x40,0x80,0x40,0x40,0xc0,0x21,0x80,0x1f,0x00,0x02,0x00,0x04
,0x00,0x08,0x00,0x10,0x00,0x20,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x0b,0x0b
,0x16,0x0d,0x00,0x02,0x20,0x80,0x51,0x80,0x89,0x00,0x8a,0x00,0x54,0x80,0x25,0x40
,0x0a,0x20,0x0a,0x20,0x11,0x40,0x30,0x80,0x20,0x00,0x0b,0x07,0x0e,0x0e,0x00,0x03
,0x80,0x00,0x80,0x00,0xe6,0x60,0x91,0x40,0x97,0x40,0x95,0x40,0xe7,0x40,0x10,0x0e
,0x1c,0x13,0x00,0x02,0x1c,0x01,0x7f,0x03,0x63,0x06,0xc1,0xcc,0x9c,0xfd,0x7f,0x73
,0x63,0x06,0xc1,0xcc,0x9c,0xfd,0x7f,0x73,0x63,0x06,0xc1,0xcc,0x80,0xfc,0x00,0x70
,0x19,0x0f,0x3c,0x1a,0x00,0x01,0x01,0xff,0xc0,0x00,0x01,0xff,0xc0,0x00,0x01,0xff
,0xc0,0x00,0x01,0xff,0xc0,0x00,0x01,0xff,0xc0,0x00,0x01,0xff,0xc0,0x00,0x01,0xff
,0xc0,0x00,0xff,0xff,0xff,0x80,0x7f,0xff,0xff,0x00,0x1f,0xff,0xfc,0x00,0x07,0xff
,0xf0,0x00,0x01,0xff,0xc0,0x00,0x00,0x7f,0x00,0x00,0x00,0x1c,0x00,0x00,0x00,0x08
,0x00,0x00]

# Activation du bus SPI
spi = spidev.SpiDev() #nouvel objet SPI
spi.open(0,0) # sur port SPI 0 CS 0
spi.max_speed_hz = 15000000 #200000 #15000000 # vitesse = 200 KHz pour le digole (max 15000000)
spi.bits_per_word = 8 #8 bits per word
spi.lsbfirst = False #MSB bits
spi.mode = 0 #mode SPI O

#- Envoie une commande (string)
def sendCmd(buf):
	for c in buf:
		spi.writebytes([ord(c)])

def sendCmd2Flash(buf,decal):
	a = decal + 1
	for c in buf:
		spi.writebytes([c])
		if(a >= 64):
			time.sleep(0.15)
			a = 1
		else:
			a = a+1
#		print a

#- Envoie une commande (valeur)
def sendVal(val):
	spi.writebytes([val])

#- Envoie plusieurs valeurs
def sendVals(val):
	for v in val:
		spi.writebytes([v])

#- Efface l'ecran		
def clearScreen():
	sendCmd("CL")

#- Affiche un texte a l'ecran
def printText(txt):
	sendCmd("TT")
	sendCmd(txt)
	sendVal(0)

#- Affiche un texte a l'ecran (avec position)
def printText2(x,y,txt):
	setCursor(x,y)
	sendCmd("TT")
	sendCmd(txt)
	sendVal(0)

#- Affiche un texte a l'ecran (avec position)
def printTextP(x,y,txt):
	setCursorP(x,y)
	sendCmd("TT")
	sendCmd(txt)
	sendVal(0)

#- Change le curseur (position)
def setCursor(x,y):
        sendCmd("TP")
        sendVal(x)
        sendVal(y)

#- Change le curseur (pixels)
def setCursorP(x,y):
        sendCmd("ETP")
        sendVal(x)
        sendVal(y)

def setCursorLastPos():
	sendCmd("ETB")

#- Dessine un pixel
def drawPixel(x,y):
        sendCmd("DP")
        sendVal(x)
        sendVal(y)

#- Dessine une ligne
def drawLine(x,y,x2,y2):
        sendCmd("LN")
        sendVal(x)
        sendVal(y)
        sendVal(x2)
        sendVal(y2)

#- Dessine un carre
def drawRect(x,y,x2,y2):
        sendCmd("DR")
        sendVal(x)
        sendVal(y)
        sendVal(x2)
        sendVal(y2)

#- Remplit un carre
def fillRect(x,y,x2,y2):
        sendCmd("FR")
        sendVal(x)
        sendVal(y)
        sendVal(x2)
        sendVal(y2)

#- Dessine ou remplit un cercle
def drawCircle(x,y,r,f):
        sendCmd("CC")
        sendVal(x)
        sendVal(y)
        sendVal(r)
        sendVal(f)

#- Affiche une image noir et blanc
def drawPic(x,y,w,h,data):
        sendCmd("DIM")
        sendVal(x)
        sendVal(y)
        sendVal(w)
        sendVal(h)
        sendVals(data)
#- Affiche une image NB prise d'un fichier
def drawPic2(x,y,w,h,data):
        sendCmd("DIM")
        sendVal(x)
        sendVal(y)
        sendVal(w)
        sendVal(h)
        sendCmd(data)
#Affiche une image couleur prise d'un fichier
def drawPic3(x,y,w,h,data):
        sendCmd("EDIM1")
        sendVal(x)
        sendVal(y)
        sendVal(w)
        sendVal(h)
        sendCmd(data)


#- Change la font
def setFont(f):
        sendCmd("SF")
        sendVal(f)

#- allume ou eteint l'ecran
def setScreen(on):
        sendCmd("SOO")
        sendVal(on)

#- change la couleur de dessin
def setFGcolor(c):
        sendCmd("SC")
        sendVal(c)

#- change la couleur du background
def setBGcolor():
        sendCmd("BGC")


#- change la couleur de dessin
def setDrawMode(m):
        sendCmd("DM")
        sendCmd(m)
	
#- change l'ecran d'accueil
def setWelcomeScreen1():
	sendCmd("SSS")
	bitm = fp.read()
	print "len=",len(bitm)
	sendVals([0x9C, 0x06])
	time.sleep(0.300)
	sendVals([0x06, 0x9A])
	#commandes sup:
	
	#avant:
	sendCmd("CLDIM")
	sendVal(25)
	sendVal(0)
	sendVal(110)
	sendVal(120)
	sendCmd2Flash(bitm,11)
	time.sleep(0.300)
	sendVal(255)

#convert 16bit integer to two 8bit integers
def convert(int32_val):
    bin = np.binary_repr(int32_val, width = 32) 
    int8_arr = [int(bin[0:8],2), int(bin[8:16],2), 
                int(bin[16:24],2), int(bin[24:32],2)]
    return int8_arr[2],int8_arr[3] 

def downloadFont(myfont,fontnum):
	clearScreen()
	#compute font lenght
	fl=len(myfont)
	print "len=",fl
	fl1,fl2=convert(fl)
	print "len conv=",hex(fl1),"-",hex(fl2)
	#send command
	sendCmd("SUF")
	#custom font number
	sendVal(fontnum)
	time.sleep(0.300)
	#send length
	sendVals([fl2,fl1])
	#send font data to flash
	sendCmd2Flash(myfont,0)
	#sleep at least 3 seconds after flash
	time.sleep(3)


#---------------------
#------ MAIN ---------
#---------------------

#downloadFont(smallfont,fSmall)
#downloadFont(bigfont,fBig)
#exit()

clearScreen()
wval=0
while 1:
	#temp chaudiere	
	setFont(fSmall)
	setFGcolor(cRouge)
	printTextP(5,20,"c")
	setFGcolor(cBlanc)
	st=random.randint(115, 124)
	printText(str(st)+"+   ")

	#pression extraction
	setFGcolor(cVert)
	printTextP(89,20,"d")	
	setFGcolor(cBlanc)
	printTextP(116,20,"     ")
	printText2(0,1," ")
	st="{0:.1f}".format(random.uniform(5, 10))
	printTextP(118,20,str(st)+"b")
	
	#niveau eau
	setFont(fBig)
	setFGcolor(cBleu)
#	printTextP(30,80,random.choice('ABCDEF'))
	printTextP(30,80,chr(ord('A')+wval))
	wval = wval + 1
	if(wval >= 6):
		wval = 0

	#temperature
	setFGcolor(cBlanc)
	st="{0:.1f}".format(random.uniform(92, 95))
	printTextP(50,80,str(st)+"+ ")

	#temperature ambiante et hygrometrie
	setFont(fSmall)
	printText2(4,6,"23+ / 40a")
	
	time.sleep(0.7)

exit()

downloadFont(bigfont,fBig)
clearScreen()
setFGcolor(254)
setFont(fBig)
printText2(0,1,"1'2,3 45")
printText2(0,2,"657.90+")
setFGcolor(3)
printTextP(0,160,"ABCDEF")

exit()

downloadFont(smallfont,fSmall)

clearScreen()
setFGcolor(254)
setFont(fSmall)
printText2(0,1,"1'2,3 45")
printText2(0,2,"657.90+ab")

setFGcolor(224) 
printText2(0,3,"c")

setFGcolor(28)
printText2(0,4,"d")

exit()

setFont(200)
#printText2(0,1,"12,3 45")
#printText2(0,2,"678.90+")
#printTextP(50,80,"92,1+")
ptextold = ""
setDrawMode('C')
#setDrawMode('O')
while 0: 
	for i in range(10):
		for j in range(10):
			ptext = "9"+str(i)+"."+str(j)+" "
			#if(len(ptextold) > 1):
			#	setFGcolor(0)
			#	printTextP(50,80,ptextold)
			#	setFGcolor(254)

			printTextP(50,80,ptext)
			ptextold = ptext
			time.sleep(0.5)
			
